// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  EMPLOYEE
  MANAGER
  ADMIN
}

enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

enum MaritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
  SEPARATED
}

enum EmergencyContactRelationship {
  SPOUSE
  PARENT
  SIBLING
  FRIEND
  OTHER
}

enum Department {
  ADMIN
  ENGINEERING
  SALES
  UI
  DEVELOPER
  OTHER
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  INTERN
  CONTRACT
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  role      Role     @default(EMPLOYEE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Employee {
  id                          String                           @id @default(uuid())
  supabaseId                  String                           @unique
  
  // Personal Information
  firstName                   String
  middleName                  String?
  lastName                    String
  dateOfBirth                 DateTime
  gender                      Gender
  maritalStatus               MaritalStatus
  contactNumber               String
  email                       String                           @unique
  emergencyContactName        String?
  emergencyContactRelationship EmergencyContactRelationship?
  emergencyContactPhone       String?
  currentAddress              String?
  permanentAddress            String?
  
  // Employment Information
  jobTitle                    String
  department                  Department
  departmentOther             String?                          // For "Other" department option
  employmentType              EmploymentType
  hireDate                    DateTime
  workLocation                String
  reportingManager            String?
  salaryGrade                 String?
  
  // Additional Information
  educationHistory            Json?                            // Array of education records
  certifications              Json?                            // Array of certifications
  skills                      String[]                         // Array of skills
  previousWorkExperience      Json?                            // Array of work experience
  bankAccountNumber           String?
  bankName                    String?
  bankBranch                  String?
  routingNumber               String?                          // IFSC Code or Routing Number
  
  // Metadata
  isActive                    Boolean                          @default(true)
  createdBy                   String?                          // Admin who created this employee
  createdAt                   DateTime                         @default(now())
  updatedAt                   DateTime                         @updatedAt
  
  // Indexes for performance
  @@index([supabaseId])
  @@index([email])
  @@index([department])
  @@index([employmentType])
  // Relations
  workflowInstances           WorkflowInstance[]
  
  // Leave Management Relations
  leaveRequests               LeaveRequest[]
  leaveBalances               LeaveBalance[]
  
  @@index([isActive])
  @@map("employees")
}
// Onboarding Workflow Enums
enum TaskType {
  DOCUMENT_SUBMISSION
  TRAINING
  ORIENTATION
  EQUIPMENT_ALLOCATION
  SYSTEM_ACCESS
  MEETING
  REVIEW
  OTHER
}

enum AssigneeType {
  ADMIN
  MANAGER
  EMPLOYEE

}

enum PriorityLevel {
  LOW
  MEDIUM
  HIGH
}

enum DurationUnit {
  HOURS
  DAYS
  WEEKS
}

enum WorkflowStatus {
  DRAFT
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum TaskInstanceStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  OVERDUE
  SKIPPED
  CANCELLED
}

enum WorkflowInstanceStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  ON_HOLD
}

enum ConditionType {
  EMPLOYEE_TYPE
  DEPARTMENT
  ROLE
  LOCATION
  HIRE_DATE
  CUSTOM
}

enum ConditionOperator {
  EQUALS
  NOT_EQUALS
  IN
  NOT_IN
  GREATER_THAN
  LESS_THAN
  CONTAINS
}

// Global Task Library
model GlobalTask {
  id                    String        @id @default(uuid())
  taskName              String
  taskType              TaskType
  description           String?
  detailedInstructions  String?
  priorityLevel         PriorityLevel @default(MEDIUM)
  duration              Int?          // Duration value
  durationUnit          DurationUnit? // Duration unit
  requiresApproval      Boolean       @default(false)
  assigneeType          AssigneeType
  approverType          AssigneeType?
  
  // Conditional Logic
  isConditional         Boolean       @default(false)
  conditionalLogic      Json?         // Condition rules
  
  // Resources and Organization
  resources             Json?         // Array of resources
  tags                  String[]      // Tags for categorization
  
  // Metadata
  isActive              Boolean       @default(true)
  createdBy             String?       // Admin who created this task
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  
  // Relations
  workflowTasks         WorkflowTask[]
  taskResources         TaskResource[]
  taskAnalytics         TaskAnalytics[]  
  @@index([taskType])
  @@index([assigneeType])
  @@index([isActive])
  @@map("global_tasks")
}

// Workflow Templates
model WorkflowTemplate {
  id                    String        @id @default(uuid())
  name                  String
  description           String?
  category              String?       // e.g., "Engineering", "Sales", "General"
  isDefault             Boolean       @default(false)
  
  // Template Configuration
  templateData          Json?         // Workflow structure and task assignments
  
  // Metadata
  isActive              Boolean       @default(true)
  createdBy             String?       // Admin who created this template
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  
  // Relations
  workflows             Workflow[]
  
  @@index([category])
  @@index([isActive])
  @@map("workflow_templates")
}

// Workflows
model Workflow {
  id                    String            @id @default(uuid())
  name                  String
  description           String?
  status                WorkflowStatus    @default(DRAFT)
  
  // Template Reference
  templateId            String?
  template              WorkflowTemplate? @relation(fields: [templateId], references: [id])
  
  // Workflow Configuration
  autoStart             Boolean           @default(false)
  estimatedDuration     Int?              // Total estimated duration in days
  
  // Conditional Application
  isConditional         Boolean           @default(false)
  conditionalLogic      Json?             // Rules for when this workflow applies
  
  // Metadata
  version               Int               @default(1)
  isActive              Boolean           @default(true)
  createdBy             String?           // Admin who created this workflow
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  
  // Relations
  workflowTasks         WorkflowTask[]
  workflowInstances     WorkflowInstance[]
  workflowAnalytics     WorkflowAnalytics[]
  
  @@index([status])
  @@index([isActive])
  @@index([templateId])
  @@map("workflows")
}

// Workflow Tasks (Tasks assigned to specific workflows)
model WorkflowTask {
  id                    String        @id @default(uuid())
  workflowId            String
  workflow              Workflow      @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  
  globalTaskId          String
  globalTask            GlobalTask    @relation(fields: [globalTaskId], references: [id])
  
  // Task Configuration in Workflow
  orderIndex            Int           // Order of task in workflow
  isRequired            Boolean       @default(true)
  deadlineDays          Int?          // Days from workflow start
  
  // Task Dependencies
  dependencies          String[]      // Array of WorkflowTask IDs that must be completed first
  
  // Custom Overrides (optional overrides of global task settings)
  customInstructions    String?       // Override global task instructions
  customDuration        Int?          // Override global task duration
  customDurationUnit    DurationUnit? // Override global task duration unit
  customAssigneeType    AssigneeType? // Override global task assignee
  customApproverType    AssigneeType? // Override global task approver
  
  // Metadata
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  
  // Relations
  taskInstances         TaskInstance[]
  
  @@unique([workflowId, globalTaskId]) // Prevent duplicate tasks in same workflow
  @@index([workflowId])
  @@index([globalTaskId])
  @@index([orderIndex])
  @@map("workflow_tasks")
}

// Workflow Instances (Per Employee)
model WorkflowInstance {
  id                    String                  @id @default(uuid())
  workflowId            String
  workflow              Workflow                @relation(fields: [workflowId], references: [id])
  
  employeeId            String
  employee              Employee                @relation(fields: [employeeId], references: [id])
  
  // Instance Status
  status                WorkflowInstanceStatus  @default(NOT_STARTED)
  progressPercentage    Decimal                 @default(0) @db.Decimal(5,2)
  
  // Timeline
  startedAt             DateTime?
  completedAt           DateTime?
  dueDate               DateTime?
  
  // Assignment
  assignedBy            String?                 // Admin/ADMIN who assigned this workflow
  
  // Metadata
  notes                 String?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  
  // Relations
  taskInstances         TaskInstance[]
  
  @@unique([workflowId, employeeId]) // One workflow instance per employee
  @@index([employeeId])
  @@index([status])
  @@index([startedAt])
  @@map("workflow_instances")
}

// Task Instances (Per Employee Per Task)
model TaskInstance {
  id                    String              @id @default(uuid())
  workflowInstanceId    String
  workflowInstance      WorkflowInstance    @relation(fields: [workflowInstanceId], references: [id], onDelete: Cascade)
  
  workflowTaskId        String
  workflowTask          WorkflowTask        @relation(fields: [workflowTaskId], references: [id])
  
  // Task Assignment
  assignedTo            String?             // User ID of assigned person
  approvedBy            String?             // User ID of approver
  
  // Task Status
  status                TaskInstanceStatus  @default(NOT_STARTED)
  
  // Timeline
  dueDate               DateTime?
  startedAt             DateTime?
  completedAt           DateTime?
  approvedAt            DateTime?
  
  // Task Data
  completionNotes       String?
  approvalNotes         String?
  attachments           Json?               // Array of file references
  formData              Json?               // Form submission data
  
  // Metadata
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@unique([workflowInstanceId, workflowTaskId]) // One task instance per workflow instance
  @@index([assignedTo])
  @@index([status])
  @@index([dueDate])
  @@map("task_instances")
}

// Notification System
enum NotificationType {
  TASK_ASSIGNED
  TASK_COMPLETED
  TASK_OVERDUE
  WORKFLOW_ASSIGNED
  WORKFLOW_COMPLETED
  MANAGER_ASSIGNED
  APPROVAL_REQUIRED
  SYSTEM_ALERT
}

enum NotificationChannel {
  IN_APP
  EMAIL
  SMS
}

enum NotificationStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED
}

model Notification {
  id                    String              @id @default(uuid())
  
  // Notification Details
  type                  NotificationType
  title                 String
  message               String
  channel               NotificationChannel
  status                NotificationStatus  @default(PENDING)
  
  // Recipients
  recipientId           String              // User ID of recipient
  recipientEmail        String?             // Email for email notifications
  
  // Related Entities
  workflowInstanceId    String?
  taskInstanceId        String?
  employeeId            String?
  
  // Metadata
  data                  Json?               // Additional notification data
  sentAt                DateTime?
  deliveredAt           DateTime?
  readAt                DateTime?
  
  // Timestamps
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@index([recipientId])
  @@index([status])
  @@index([type])
  @@index([createdAt])
  @@map("notifications")
}

// Role Assignment Rules
model RoleAssignmentRule {
  id                    String              @id @default(uuid())
  
  // Rule Configuration
  name                  String
  description           String?
  isActive              Boolean             @default(true)
  priority              Int                 @default(0) // Higher priority rules are evaluated first
  
  // Conditions
  conditions            Json                // Array of conditions to match
  targetRole            Role                // Role to assign when conditions match
  
  // Metadata
  createdBy             String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@index([isActive])
  @@index([priority])
  @@map("role_assignment_rules")
}

// Document and Resource Management
enum ResourceType {
  DOCUMENT
  LINK
  VIDEO
  IMAGE
  FORM
  TOOL
  CONTACT
}

model TaskResource {
  id                    String              @id @default(uuid())
  
  // Resource Details
  name                  String
  description           String?
  type                  ResourceType
  url                   String?             // For links or file URLs
  filePath              String?             // For uploaded files
  fileName              String?             // Original file name
  fileSize              Int?                // File size in bytes
  mimeType              String?             // File MIME type
  
  // Metadata
  metadata              Json?               // Additional resource metadata
  isRequired            Boolean             @default(false)
  
  // Relations
  globalTaskId          String?
  globalTask            GlobalTask?         @relation(fields: [globalTaskId], references: [id], onDelete: Cascade)
  
  // Timestamps
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@index([globalTaskId])
  @@index([type])
  @@map("task_resources")
}

// Analytics and Reporting
model WorkflowAnalytics {
  id                    String              @id @default(uuid())
  
  // Analytics Data
  workflowId            String
  workflow              Workflow            @relation(fields: [workflowId], references: [id])
  
  // Metrics
  totalInstances        Int                 @default(0)
  completedInstances    Int                 @default(0)
  averageCompletionTime Decimal?            @db.Decimal(10,2) // In hours
  averageTasksPerInstance Decimal?          @db.Decimal(10,2)
  
  // Time-based metrics
  reportDate            DateTime            @default(now())
  periodStart           DateTime
  periodEnd             DateTime
  
  // Additional metrics
  metricsData           Json?               // Detailed analytics data
  
  // Timestamps
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@unique([workflowId, reportDate])
  @@index([workflowId])
  @@index([reportDate])
  @@map("workflow_analytics")
}

model TaskAnalytics {
  id                    String              @id @default(uuid())
  
  // Analytics Data
  globalTaskId          String
  globalTask            GlobalTask          @relation(fields: [globalTaskId], references: [id])
  
  // Metrics
  totalAssignments      Int                 @default(0)
  completedAssignments  Int                 @default(0)
  averageCompletionTime Decimal?            @db.Decimal(10,2) // In hours
  overdueTasks          Int                 @default(0)
  
  // Time-based metrics
  reportDate            DateTime            @default(now())
  periodStart           DateTime
  periodEnd             DateTime
  
  // Additional metrics
  metricsData           Json?               // Detailed analytics data
  
  // Timestamps
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@unique([globalTaskId, reportDate])
  @@index([globalTaskId])
  @@index([reportDate])
  @@map("task_analytics")
}

// Leave Management Enums
enum LeaveType {
  CASUAL
  SICK
  EARNED
  OPTIONAL_HOLIDAY
  REGIONAL_FLEX_HOLIDAY
  BONALU_HOLIDAY
  COMP_OFF
  MATERNITY
  PATERNITY
  BEREAVEMENT
  LEAVE_WITHOUT_PAY
  WORK_FROM_HOME
}

enum LeaveRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  WITHDRAWN
}

enum LeaveApprovalLevel {
  AUTO
  MANAGER
  HR
  BOTH
}

enum LeaveCreditType {
  YEARLY
  MONTHLY
  EARNED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  HALF_DAY
  WORK_FROM_HOME
  LATE
}

// Leave Management Models

// Leave Policy Configuration
model LeavePolicy {
  id                    String              @id @default(uuid())
  
  // Policy Details
  code                  String              @unique // CL, SL, EL, etc.
  name                  String
  leaveType             LeaveType
  description           String?
  
  // Quota and Credits
  quota                 Int?                // Yearly/monthly quota
  creditType            LeaveCreditType     @default(YEARLY)
  accrualRate           Decimal?            @db.Decimal(10,2) // For monthly accrual
  
  // Carry Forward Rules
  carryForward          Boolean             @default(false)
  maxCarryForward       Int?                // Max days to carry forward
  carryForwardExpiry    Int?                // Days after which carried forward leave expires
  
  // Usage Rules
  encashable            Boolean             @default(false)
  encashLimitPerYear    Int?
  halfDayAllowed        Boolean             @default(true)
  allowNegative         Boolean             @default(false)
  maxNegativeAllowed    Int?                // Negative balance limit
  
  // Approval Workflow
  approvalLevel         LeaveApprovalLevel  @default(MANAGER)
  autoApprovalEnabled   Boolean             @default(false)
  autoApprovalConditions Json?              // Conditions for auto approval
  
  // Notice and Documentation
  noticePeriodDays      Int                 @default(0)
  documentationRequired Boolean             @default(false)
  documentationRules    Json?               // Rules for when documentation is required
  
  // Applicability
  applicableLocations   String[]            // Empty = all locations
  applicableDepartments String[]            // Empty = all departments
  applicableRoles       String[]            // Empty = all roles
  
  // Special Rules
  usageWindowDays       Int?                // Window to use the leave (for paternity, etc.)
  expiryDays           Int?                // Leave expires after X days (for comp off)
  salaryDeduction      Boolean             @default(false)
  
  // Metadata
  isActive              Boolean             @default(true)
  version               Int                 @default(1)
  effectiveFrom         DateTime            @default(now())
  effectiveUntil        DateTime?
  createdBy             String
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  // Relations
  leaveRequests         LeaveRequest[]
  leaveBalances         LeaveBalance[]
  
  @@index([leaveType])
  @@index([isActive])
  @@index([effectiveFrom])
  @@map("leave_policies")
}

// Employee Leave Balance
model LeaveBalance {
  id                    String              @id @default(uuid())
  
  // Employee & Policy
  employeeId            String
  employee              Employee            @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  policyId              String
  policy                LeavePolicy         @relation(fields: [policyId], references: [id], onDelete: Cascade)
  
  // Balance Tracking
  fiscalYear            Int                 // e.g., 2025
  totalEntitlement      Decimal             @db.Decimal(10,2)
  usedLeaves            Decimal             @db.Decimal(10,2) @default(0)
  pendingLeaves         Decimal             @db.Decimal(10,2) @default(0)
  availableBalance      Decimal             @db.Decimal(10,2)
  carriedForward        Decimal             @db.Decimal(10,2) @default(0)
  
  // Encashment Tracking
  encashedThisYear      Decimal             @db.Decimal(10,2) @default(0)
  
  // Metadata
  lastUpdated           DateTime            @default(now())
  updatedBy             String?             // Who updated the balance
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@unique([employeeId, policyId, fiscalYear])
  @@index([employeeId])
  @@index([fiscalYear])
  @@index([policyId])
  @@map("leave_balances")
}

// Leave Request
model LeaveRequest {
  id                    String              @id @default(uuid())
  
  // Employee & Policy
  employeeId            String
  employee              Employee            @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  policyId              String
  policy                LeavePolicy         @relation(fields: [policyId], references: [id], onDelete: Restrict)
  
  // Leave Details
  leaveType             LeaveType
  startDate             DateTime
  endDate               DateTime
  totalDays             Decimal             @db.Decimal(10,2)
  isHalfDay             Boolean             @default(false)
  halfDaySession        String?             // "FIRST_HALF" or "SECOND_HALF"
  reason                String
  
  // Request Status
  status                LeaveRequestStatus  @default(PENDING)
  appliedAt             DateTime            @default(now())
  
  // Manager Approval
  managerApprovedBy     String?
  managerApprovedAt     DateTime?
  managerComments       String?
  managerApprovalStatus LeaveRequestStatus?
  
  // HR Approval
  hrApprovedBy          String?
  hrApprovedAt          DateTime?
  hrComments            String?
  hrApprovalStatus      LeaveRequestStatus?
  
  // Final Approval
  finalApprovedBy       String?
  finalApprovedAt       DateTime?
  finalStatus           LeaveRequestStatus?
  
  // Rejection/Cancellation
  rejectedBy            String?
  rejectedAt            DateTime?
  rejectionReason       String?
  
  cancelledBy           String?
  cancelledAt           DateTime?
  cancellationReason    String?
  
  // Additional Data
  attachments           Json?               // Array of attachment URLs/metadata
  emergencyContact      Json?               // Emergency contact during leave
  workHandover          String?             // Work handover notes
  
  // Metadata
  isBackdated           Boolean             @default(false)
  notificationsSent     Boolean             @default(false)
  balanceAdjusted       Boolean             @default(false)
  ipAddress             String?
  userAgent             String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  // Relations
  auditLogs             LeaveAuditLog[]
  
  @@index([employeeId])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@index([leaveType])
  @@index([appliedAt])
  @@map("leave_requests")
}

// Leave Audit Trail
model LeaveAuditLog {
  id                    String              @id @default(uuid())
  
  // Request Reference
  leaveRequestId        String
  leaveRequest          LeaveRequest        @relation(fields: [leaveRequestId], references: [id], onDelete: Cascade)
  
  // Action Details
  action                String              // CREATED, UPDATED, APPROVED, REJECTED, CANCELLED, WITHDRAWN
  performedBy           String              // User ID
  performedByEmail      String
  performedByRole       String
  performedByName       String
  
  // Change Details
  previousStatus        String?
  newStatus             String?
  fieldChanges          Json?               // Detailed field-level changes
  comments              String?
  reason                String?
  
  // Request Context
  ipAddress             String?
  userAgent             String?
  requestHeaders        Json?               // Additional request metadata
  
  // Timestamp
  timestamp             DateTime            @default(now())
  
  @@index([leaveRequestId])
  @@index([performedBy])
  @@index([action])
  @@index([timestamp])
  @@map("leave_audit_logs")
}

// Leave Analytics
model LeaveAnalytics {
  id                    String              @id @default(uuid())
  
  // Scope
  department            String?             // null = organization-wide
  location              String?             // null = all locations
  fiscalYear            Int
  month                 Int?                // null = yearly stats
  
  // Request Metrics
  totalRequests         Int                 @default(0)
  approvedRequests      Int                 @default(0)
  rejectedRequests      Int                 @default(0)
  pendingRequests       Int                 @default(0)
  cancelledRequests     Int                 @default(0)
  
  // Leave Type Breakdown
  leaveTypeBreakdown    Json                // { "CASUAL": 50, "SICK": 30, ... }
  
  // Usage Metrics
  totalLeaveDays        Decimal             @db.Decimal(10,2)
  averageLeaveDays      Decimal             @db.Decimal(10,2)
  utilizationRate       Decimal             @db.Decimal(5,2) // Percentage
  
  // Approval Metrics
  averageApprovalTime   Decimal?            @db.Decimal(10,2) // Hours
  autoApprovalCount     Int                 @default(0)
  managerApprovalCount  Int                 @default(0)
  hrApprovalCount       Int                 @default(0)
  
  // Trends
  comparisonPrevPeriod  Json?               // Growth/decline metrics
  seasonalTrends        Json?               // Seasonal patterns
  
  // Timestamps
  reportDate            DateTime            @default(now())
  periodStart           DateTime
  periodEnd             DateTime
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@unique([department, location, fiscalYear, month])
  @@index([fiscalYear])
  @@index([department])
  @@index([location])
  @@index([reportDate])
  @@map("leave_analytics")
}

// Leave Settings and Configuration
model LeaveSettings {
  id                    String              @id @default(uuid())
  
  // System Configuration
  fiscalYearStart       String              @default("01-04") // DD-MM format
  weekendDays           String[]            @default(["SATURDAY", "SUNDAY"])
  workingHoursPerDay    Decimal             @db.Decimal(4,2) @default(8.0)
  halfDayHours          Decimal             @db.Decimal(4,2) @default(4.0)
  
  // Company Locations and Rules
  companyLocations      String[]            @default([])
  probationRestrictions Boolean             @default(false)
  probationPeriodMonths Int                 @default(6)
  negativeLeaveAllowed  Boolean             @default(false)
  maxNegativeLeave      Int                 @default(0)
  
  // Approval and Workflow
  autoApprovalEnabled   Boolean             @default(false)
  autoApprovalRules     Json?               // Global auto approval conditions
  escalationEnabled     Boolean             @default(false)
  escalationAfterDays   Int                 @default(3)
  escalationRecipients  String[]            // HR emails for escalation
  
  // Notification Settings
  emailNotifications    Boolean             @default(true)
  inAppNotifications    Boolean             @default(true)
  smsNotifications      Boolean             @default(false)
  reminderEnabled       Boolean             @default(true)
  reminderBeforeDays    Int                 @default(7)
  notificationTemplates Json?               // Email/SMS templates
  
  // Holiday and Calendar Settings
  holidayCalendarEnabled Boolean            @default(true)
  nationalHolidays      Json?               // List of national holidays
  regionalHolidays      Json?               // Location-specific holidays
  optionalHolidays      Json?               // Optional holidays
  
  // Attendance Integration
  attendanceIntegration Boolean             @default(false)
  autoAbsentIfNoCheckIn Boolean             @default(true)
  autoLWPIfNoLeave      Boolean             @default(true)
  gracePeriodHours      Int                 @default(48)
  lateMarkRules         Json?               // Late mark deduction rules
  
  // Compliance and Security
  require2FA            Boolean             @default(false)
  auditLogRetention     Int                 @default(2555) // Days (7 years)
  sessionTimeout        Int                 @default(30) // Minutes
  maxBackdatedDays      Int                 @default(7)
  
  // HR Override Permissions
  hrCanEditBalance      Boolean             @default(true)
  hrCanForceApprove     Boolean             @default(true)
  hrCanModifyCalendar   Boolean             @default(true)
  hrCanAdjustAttendance Boolean             @default(true)
  hrCanAddSpecialLeaves Boolean             @default(true)
  
  // Encashment Settings
  encashmentEnabled     Boolean             @default(false)
  encashmentPeriod      String?             // "YEARLY", "HALF_YEARLY", "QUARTERLY"
  encashmentCalculation String?             // "BASIC_SALARY", "GROSS_SALARY"
  maxEncashmentPercent  Decimal?            @db.Decimal(5,2) // Max percentage of available leave
  
  // Metadata
  version               Int                 @default(1)
  lastUpdatedBy         String
  lastUpdatedAt         DateTime            @default(now())
  createdBy             String
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@map("leave_settings")
}

// Holiday Calendar
model Holiday {
  id                    String              @id @default(uuid())
  
  // Holiday Details
  name                  String
  date                  DateTime
  dayOfWeek             String
  type                  String              // "FIXED", "OPTIONAL", "REGIONAL"
  description           String?
  
  // Applicability
  applicableLocations   String[]            // Empty = all locations
  isNationalHoliday     Boolean             @default(false)
  isOptional            Boolean             @default(false)
  
  // Configuration
  fiscalYear            Int
  isActive              Boolean             @default(true)
  createdBy             String
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  
  @@index([date])
  @@index([fiscalYear])
  @@index([isActive])
  @@index([type])
  @@map("holidays")
}

